import{r as l,f as N,t as d,j as e,H as Y}from"./app-DT6URmyL.js";import{S as Z}from"./SellerLayout-DL7dHDAr.js";import{B as f}from"./button-BJ5yyv9L.js";import{I as m,L as g}from"./label-B0Oir3a4.js";import{B as M}from"./badge-eQ2CDiQ4.js";import{D as ee,a as se,b as te,c as ae,e as re,d as ie}from"./dialog-CDQkQqbE.js";import{D as ne,a as le,b as ce,c as T}from"./dropdown-menu-BZxFdXat.js";import{S as de}from"./search-CXOCqvPR.js";import{L as w}from"./loader-circle-B9Yz95ac.js";import{A as oe}from"./SellerSidebar-BjpgUw6_.js";import{E as me}from"./ellipsis-vertical-CH-22Z4U.js";import{P as xe}from"./pencil-DqWXEeAw.js";import{T as ue}from"./trash-2-Bi7v2j-E.js";import{P as pe}from"./percent-CwkdeAWl.js";import"./createLucideIcon-nG_AZEu4.js";import"./index-BiXLby2l.js";import"./index-C4D_wrp4.js";import"./index-Qjl_c6Xd.js";import"./index-BwcSwxRq.js";import"./index-DgeQzLEY.js";import"./tslib.es6-BKH_Rm7U.js";import"./index-DopqKkOV.js";import"./index-B_Flsc5j.js";import"./auth-BfG43uQt.js";const Te=()=>{var P,I,R,k,E;const[$,B]=l.useState([]),[V,v]=l.useState(!0),[x,O]=l.useState(""),[Q,u]=l.useState(!1),[r,_]=l.useState(null),[S,p]=l.useState(null),[he,L]=l.useState(null),[h,C]=l.useState(null),[y,D]=l.useState(!1),[t,c]=l.useState({quantity:0,web_price:0,web_discount:0,discount_type:"currency"});l.useEffect(()=>{b()},[]);const b=async()=>{try{v(!0);const s=await N.get("/api/all-stocks",{params:{with:"all"}});s.data.status==="success"&&B(s.data.data)}catch(s){console.error("Failed to fetch stocks",s),d.error("Failed to load stocks")}finally{v(!1)}},H=s=>{_(s),c({quantity:Number(s.quantity),web_price:Number(s.web_price),web_discount:Number(s.web_discount),discount_type:"currency"}),s.variation_stocks&&s.variation_stocks.length>0&&s.variation_stocks[0].image?p("/"+s.variation_stocks[0].image):p(null),u(!0)},z=s=>{if(s.target.files&&s.target.files[0]){const a=s.target.files[0];L(a),p(URL.createObjectURL(a))}},G=async s=>{var a,i;if(s.preventDefault(),!!r){D(!0);try{const n={id:r.id,quantity:t.quantity,web_price:t.web_price,pos_price:r.pos_price,web_discount:t.discount_type==="percentage"?t.web_price*t.web_discount/100:t.web_discount,pos_discount:0},o=await N.put("/api/stocks",n);o.data.status==="success"?(d.success("Stock updated successfully"),u(!1),b(),F()):d.error(o.data.message||"Failed to update stock")}catch(n){console.error("Update error:",n),d.error(((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update stock")}finally{D(!1)}}},J=async s=>{var a,i;if(confirm("Are you sure you want to delete this stock? This action cannot be undone.")){C(s);try{const n=await N.delete("/api/stocks",{data:{id:s}});n.data.status==="success"?(d.success("Stock deleted successfully"),b()):d.error(n.data.message||"Failed to delete stock")}catch(n){console.error("Delete error:",n),d.error(((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to delete stock")}finally{C(null)}}},F=()=>{_(null),c({quantity:0,web_price:0,web_discount:0,discount_type:"currency"}),p(null),L(null)},j=s=>!s||s.length===0?"No Variation":s.map(a=>{var i;return((i=a.variation_option)==null?void 0:i.name)||"N/A"}).join(" + "),q=$.filter(s=>{var a,i;return((i=(a=s.product)==null?void 0:a.name)==null?void 0:i.toLowerCase().includes(x.toLowerCase()))||j(s.variation_stocks).toLowerCase().includes(x.toLowerCase())}),W=s=>s.quantity-(s.reserved_quantity||0);return e.jsxs(Z,{children:[e.jsx(Y,{title:"Manage Stocks | Seller Center"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manage Stocks"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Edit or delete your product stocks"})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(m,{placeholder:"Search stocks...",className:"pl-9 bg-white",value:x,onChange:s=>O(s.target.value)})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Product"}),e.jsx("th",{className:"px-6 py-3",children:"Variation"}),e.jsx("th",{className:"px-6 py-3",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3",children:"Price"}),e.jsx("th",{className:"px-6 py-3",children:"Discount"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:V?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:[e.jsx(w,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),"Loading stocks..."]})}):q.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(oe,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"No stocks found"}),e.jsx("p",{children:x?"Try a different search term":"Add stock to your products to get started"})]})}):q.map(s=>{var a,i,n,o,K,U,A;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 flex-shrink-0 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:(a=s.product)!=null&&a.primary_image?"/"+s.product.primary_image:"https://via.placeholder.com/64?text=No+Image",alt:((i=s.product)==null?void 0:i.name)||"Product",className:"h-full w-full object-cover",onError:X=>{X.target.src="https://via.placeholder.com/64?text=No+Img"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((n=s.product)==null?void 0:n.name)||"Unknown Product"}),e.jsxs("div",{className:"text-gray-500 text-xs",children:[((K=(o=s.product)==null?void 0:o.brand)==null?void 0:K.name)&&e.jsxs("span",{className:"mr-2",children:["Brand: ",s.product.brand.name]}),((A=(U=s.product)==null?void 0:U.category)==null?void 0:A.name)&&e.jsxs("span",{children:["Category: ",s.product.category.name]})]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(M,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:j(s.variation_stocks)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[W(s)," available"]}),s.reserved_quantity>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:[s.reserved_quantity," reserved"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total: ",s.quantity]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["LKR ",s.web_price.toLocaleString()]}),s.web_discount>0&&e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["Final: LKR ",(s.web_price-s.web_discount).toLocaleString()]})]})}),e.jsx("td",{className:"px-6 py-4",children:s.web_discount>0?e.jsxs(M,{className:"bg-red-100 text-red-700 hover:bg-red-200 border-red-200",children:["-LKR ",s.web_discount.toLocaleString()]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No discount"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500",disabled:h===s.id,children:h===s.id?e.jsx(w,{className:"h-4 w-4 animate-spin"}):e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(ce,{align:"end",className:"bg-white",children:[e.jsxs(T,{onClick:()=>H(s),disabled:h!==null,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Edit"]}),e.jsxs(T,{className:"text-red-600",onClick:()=>J(s.id),disabled:h!==null,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Delete"]})]})]})})]},s.id)})})]})})]})]}),e.jsx(ee,{open:Q,onOpenChange:u,children:e.jsxs(se,{className:"max-w-2xl bg-white",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Edit Stock"}),e.jsx(re,{children:"Update the stock details below."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto py-4",children:e.jsxs("form",{id:"edit-stock-form",onSubmit:G,className:"space-y-6",children:[r&&e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 bg-white rounded-md overflow-hidden border border-blue-200",children:e.jsx("img",{src:(P=r.product)!=null&&P.primary_image?"/"+r.product.primary_image:"https://via.placeholder.com/80?text=No+Image",alt:((I=r.product)==null?void 0:I.name)||"Product",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:(R=r.product)==null?void 0:R.name}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Variation:"})," ",j(r.variation_stocks)]}),((E=(k=r.product)==null?void 0:k.brand)==null?void 0:E.name)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Brand: ",r.product.brand.name]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"image",children:"Variation Image"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[S&&e.jsx("div",{className:"w-full h-40 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:S,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsx(m,{id:"image",type:"file",accept:"image/*",onChange:z,className:"cursor-pointer bg-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload a new image for this variation (optional)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(g,{htmlFor:"quantity",children:"Quantity"}),e.jsx(m,{id:"quantity",type:"number",min:"0",required:!0,value:t.quantity,onChange:s=>c({...t,quantity:parseInt(s.target.value)||0}),placeholder:"Stock quantity",className:"bg-white"}),r&&r.reserved_quantity>0&&e.jsxs("p",{className:"text-xs text-orange-600",children:["Note: ",r.reserved_quantity," units are currently reserved in pending orders"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"web_price",children:"Price (LKR )"}),e.jsx(m,{id:"web_price",type:"number",min:"0",step:"0.01",required:!0,value:t.web_price,onChange:s=>c({...t,web_price:parseFloat(s.target.value)||0}),placeholder:"0.00",className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"web_discount",children:"Discount"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{id:"web_discount",type:"number",min:"0",step:"0.01",max:t.discount_type==="percentage"?100:t.web_price,value:t.web_discount,onChange:s=>c({...t,web_discount:parseFloat(s.target.value)||0}),placeholder:t.discount_type==="percentage"?"10":"0.00",className:"bg-white pr-8"}),t.discount_type==="percentage"&&e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"%"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 h-10 border border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>c({...t,discount_type:"percentage",web_discount:0}),className:`px-3 rounded-md text-sm font-medium transition-all ${t.discount_type==="percentage"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>c({...t,discount_type:"currency",web_discount:0}),className:`px-3 rounded-md text-sm font-medium transition-all ${t.discount_type==="currency"?"bg-white text-green-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:e.jsx("span",{className:"text-xs font-bold",children:"LKR"})})]})]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Price Preview"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Original Price:"}),e.jsxs("span",{className:"text-lg font-medium text-gray-900",children:["LKR ",Number(t.web_price).toFixed(2)]})]}),t.web_discount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Discount:"}),e.jsx("span",{className:"text-lg font-medium text-red-600",children:t.discount_type==="percentage"?`${t.web_discount}% (-LKR ${(Number(t.web_price)*Number(t.web_discount)/100).toFixed(2)})`:`-LKR ${Number(t.web_discount).toFixed(2)}`})]}),e.jsxs("div",{className:"border-t border-green-300 pt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Final Price:"}),e.jsx("span",{className:"text-xl font-bold text-green-700",children:t.discount_type==="percentage"?`LKR ${(Number(t.web_price)*(1-Number(t.web_discount)/100)).toFixed(2)}`:`LKR ${(Number(t.web_price)-Number(t.web_discount)).toFixed(2)}`})]})]})]})]})]})}),e.jsxs(ie,{children:[e.jsx(f,{variant:"outline",onClick:()=>{u(!1),F()},disabled:y,children:"Cancel"}),e.jsxs(f,{form:"edit-stock-form",type:"submit",disabled:y,className:"bg-green-600 hover:bg-green-700 text-white",children:[y?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):null,"Update Stock"]})]})]})})]})};export{Te as default};
