import{r as n,e as N,t as c,j as e,L as Z}from"./app-BevSkdG7.js";import{S as $}from"./SellerLayout-CTbuJ4A_.js";import{B as f}from"./button-DoIombom.js";import{I as m,L as g}from"./label-BHSfXJoT.js";import{B}from"./badge-xvfst9Cd.js";import{D as ee,a as se,b as te,c as ae,e as re,d as ie}from"./dialog-B1MP9hr-.js";import{D as le,a as ne,b as ce,c as V}from"./dropdown-menu-DVRQD0v4.js";import{S as de}from"./search-I-W0diZz.js";import{L as v}from"./loader-circle-yeZcuZFh.js";import{A as oe}from"./SellerSidebar-BlXJOl8A.js";import{E as me}from"./ellipsis-vertical-ab4jgIAc.js";import{P as xe}from"./pencil-Be4OL9Wm.js";import{T as ue}from"./trash-2-DkZRm_qV.js";import"./createLucideIcon-B2Y984Ia.js";import"./index-DzPF9EFL.js";import"./index-CqE6tAZT.js";import"./index-C9iIj63M.js";import"./tslib.es6-BUas5LQb.js";import"./index-Dn5UhpWC.js";import"./index-CeNcb58v.js";import"./auth-BlSIcDT4.js";const Ae=()=>{var I,P,E,k,U;const[O,Q]=n.useState([]),[R,w]=n.useState(!0),[x,z]=n.useState(""),[H,u]=n.useState(!1),[a,_]=n.useState(null),[S,p]=n.useState(null),[pe,D]=n.useState(null),[h,C]=n.useState(null),[j,F]=n.useState(!1),[r,d]=n.useState({quantity:0,web_price:0,web_discount:0});n.useEffect(()=>{b()},[]);const b=async()=>{try{w(!0);const s=await N.get("/api/all-stocks",{params:{with:"all"}});s.data.status==="success"&&Q(s.data.data)}catch(s){console.error("Failed to fetch stocks",s),c.error("Failed to load stocks")}finally{w(!1)}},G=s=>{_(s),d({quantity:Number(s.quantity),web_price:Number(s.web_price),web_discount:Number(s.web_discount)}),s.variation_stocks&&s.variation_stocks.length>0&&s.variation_stocks[0].image?p("/"+s.variation_stocks[0].image):p(null),u(!0)},J=s=>{if(s.target.files&&s.target.files[0]){const t=s.target.files[0];D(t),p(URL.createObjectURL(t))}},K=async s=>{var t,i;if(s.preventDefault(),!!a){F(!0);try{const l={id:a.id,quantity:r.quantity,web_price:r.web_price,pos_price:a.pos_price,web_discount:r.web_discount,pos_discount:0},o=await N.put("/api/stocks",l);o.data.status==="success"?(c.success("Stock updated successfully"),u(!1),b(),q()):c.error(o.data.message||"Failed to update stock")}catch(l){console.error("Update error:",l),c.error(((i=(t=l.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to update stock")}finally{F(!1)}}},W=async s=>{var t,i;if(confirm("Are you sure you want to delete this stock? This action cannot be undone.")){C(s);try{const l=await N.delete("/api/stocks",{data:{id:s}});l.data.status==="success"?(c.success("Stock deleted successfully"),b()):c.error(l.data.message||"Failed to delete stock")}catch(l){console.error("Delete error:",l),c.error(((i=(t=l.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to delete stock")}finally{C(null)}}},q=()=>{_(null),d({quantity:0,web_price:0,web_discount:0}),p(null),D(null)},y=s=>!s||s.length===0?"No Variation":s.map(t=>{var i;return((i=t.variation_option)==null?void 0:i.name)||"N/A"}).join(" + "),L=O.filter(s=>{var t,i;return((i=(t=s.product)==null?void 0:t.name)==null?void 0:i.toLowerCase().includes(x.toLowerCase()))||y(s.variation_stocks).toLowerCase().includes(x.toLowerCase())}),X=s=>s.quantity-(s.reserved_quantity||0);return e.jsxs($,{children:[e.jsx(Z,{title:"Manage Stocks | Seller Center"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manage Stocks"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Edit or delete your product stocks"})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(m,{placeholder:"Search stocks...",className:"pl-9 bg-white",value:x,onChange:s=>z(s.target.value)})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Product"}),e.jsx("th",{className:"px-6 py-3",children:"Variation"}),e.jsx("th",{className:"px-6 py-3",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3",children:"Price"}),e.jsx("th",{className:"px-6 py-3",children:"Discount"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:R?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:[e.jsx(v,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),"Loading stocks..."]})}):L.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(oe,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"No stocks found"}),e.jsx("p",{children:x?"Try a different search term":"Add stock to your products to get started"})]})}):L.map(s=>{var t,i,l,o,A,M,T;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 flex-shrink-0 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:(t=s.product)!=null&&t.primary_image?"/"+s.product.primary_image:"https://via.placeholder.com/64?text=No+Image",alt:((i=s.product)==null?void 0:i.name)||"Product",className:"h-full w-full object-cover",onError:Y=>{Y.target.src="https://via.placeholder.com/64?text=No+Img"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:((l=s.product)==null?void 0:l.name)||"Unknown Product"}),e.jsxs("div",{className:"text-gray-500 text-xs",children:[((A=(o=s.product)==null?void 0:o.brand)==null?void 0:A.name)&&e.jsxs("span",{className:"mr-2",children:["Brand: ",s.product.brand.name]}),((T=(M=s.product)==null?void 0:M.category)==null?void 0:T.name)&&e.jsxs("span",{children:["Category: ",s.product.category.name]})]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(B,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:y(s.variation_stocks)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[X(s)," available"]}),s.reserved_quantity>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:[s.reserved_quantity," reserved"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total: ",s.quantity]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["¥",s.web_price.toLocaleString()]}),s.web_discount>0&&e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["Final: ¥",(s.web_price-s.web_discount).toLocaleString()]})]})}),e.jsx("td",{className:"px-6 py-4",children:s.web_discount>0?e.jsxs(B,{className:"bg-red-100 text-red-700 hover:bg-red-200 border-red-200",children:["-¥",s.web_discount.toLocaleString()]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No discount"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-500",disabled:h===s.id,children:h===s.id?e.jsx(v,{className:"h-4 w-4 animate-spin"}):e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(ce,{align:"end",className:"bg-white",children:[e.jsxs(V,{onClick:()=>G(s),disabled:h!==null,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"})," Edit"]}),e.jsxs(V,{className:"text-red-600",onClick:()=>W(s.id),disabled:h!==null,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Delete"]})]})]})})]},s.id)})})]})})]})]}),e.jsx(ee,{open:H,onOpenChange:u,children:e.jsxs(se,{className:"max-w-2xl bg-white",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Edit Stock"}),e.jsx(re,{children:"Update the stock details below."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto py-4",children:e.jsxs("form",{id:"edit-stock-form",onSubmit:K,className:"space-y-6",children:[a&&e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 bg-white rounded-md overflow-hidden border border-blue-200",children:e.jsx("img",{src:(I=a.product)!=null&&I.primary_image?"/"+a.product.primary_image:"https://via.placeholder.com/80?text=No+Image",alt:((P=a.product)==null?void 0:P.name)||"Product",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:(E=a.product)==null?void 0:E.name}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Variation:"})," ",y(a.variation_stocks)]}),((U=(k=a.product)==null?void 0:k.brand)==null?void 0:U.name)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Brand: ",a.product.brand.name]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"image",children:"Variation Image"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[S&&e.jsx("div",{className:"w-full h-40 bg-gray-100 rounded-md overflow-hidden border border-gray-200",children:e.jsx("img",{src:S,alt:"Preview",className:"w-full h-full object-cover"})}),e.jsx(m,{id:"image",type:"file",accept:"image/*",onChange:J,className:"cursor-pointer bg-white"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload a new image for this variation (optional)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(g,{htmlFor:"quantity",children:"Quantity"}),e.jsx(m,{id:"quantity",type:"number",min:"0",required:!0,value:r.quantity,onChange:s=>d({...r,quantity:parseInt(s.target.value)||0}),placeholder:"Stock quantity",className:"bg-white"}),a&&a.reserved_quantity>0&&e.jsxs("p",{className:"text-xs text-orange-600",children:["Note: ",a.reserved_quantity," units are currently reserved in pending orders"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"web_price",children:"Price (¥)"}),e.jsx(m,{id:"web_price",type:"number",min:"0",step:"0.01",required:!0,value:r.web_price,onChange:s=>d({...r,web_price:parseFloat(s.target.value)||0}),placeholder:"0.00",className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"web_discount",children:"Discount Amount (¥)"}),e.jsx(m,{id:"web_discount",type:"number",min:"0",step:"0.01",value:r.web_discount,onChange:s=>d({...r,web_discount:parseFloat(s.target.value)||0}),placeholder:"0.00",className:"bg-white"})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Price Preview"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Original Price:"}),e.jsxs("span",{className:"text-lg font-medium text-gray-900",children:["¥",Number(r.web_price).toFixed(2)]})]}),r.web_discount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"text-lg font-medium text-red-600",children:["-¥",Number(r.web_discount).toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-green-300 pt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Final Price:"}),e.jsxs("span",{className:"text-xl font-bold text-green-700",children:["¥",(Number(r.web_price)-Number(r.web_discount)).toFixed(2)]})]})]})]})]})]})}),e.jsxs(ie,{children:[e.jsx(f,{variant:"outline",onClick:()=>{u(!1),q()},disabled:j,children:"Cancel"}),e.jsxs(f,{form:"edit-stock-form",type:"submit",disabled:j,className:"bg-green-600 hover:bg-green-700 text-white",children:[j?e.jsx(v,{className:"w-4 h-4 animate-spin mr-2"}):null,"Update Stock"]})]})]})})]})};export{Ae as default};
