import{r as n,j as e,t as i,f as xe,H as ue}from"./app-B1e7NyTU.js";import{S as be}from"./SellerLayout-BfuBhsYt.js";import{d as fe,e as ye,f as je,g as ve,a as Ne,c as we}from"./seller-mkR15d-Z.js";import{B as m}from"./button-DsMbreBE.js";import{L as x,I as f}from"./label-MAmg8Kdd.js";import{D as le,a as oe,b as ce,c as de,e as he,d as me}from"./dialog-yvYWYk4h.js";import{C as Se}from"./checkbox-CKAhI79W.js";import{T as _e}from"./textarea-D0p2GLEv.js";import{a as re}from"./auth-CaAddT7o.js";import{P as Y,a as H,I as W,L as ne}from"./SellerSidebar-Sjhv_r54.js";import{c as ge}from"./createLucideIcon-C_or0Ppn.js";import{X as ee}from"./index-Cavn4-jo.js";import{C as A}from"./index-DDcVAkqO.js";import{C as Ce}from"./circle-alert-BVEBOrTO.js";import{T as ke}from"./trash-2-DLbZtaCc.js";import{S as Ve,a as Pe,b as Ie,c as Fe,d as Le}from"./select-Cb4rBbnp.js";import{S as De}from"./search-BhQeRFPg.js";import{L as ie}from"./loader-circle-CtfapZmI.js";import{A as Ee}from"./arrow-right-BodZ_xsk.js";import"./dropdown-menu-BR7HJMda.js";import"./index-DaxKduEr.js";import"./index-zyc6NlEg.js";import"./tslib.es6-BKH_Rm7U.js";import"./index-Z79Xdywb.js";import"./index-DARdZlap.js";import"./index-BvRVcNN7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Te=ge("FileText",Oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],Re=ge("PenLine",Be);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]],ze=ge("Type",qe),Me=({isOpen:D,onClose:_,product:r,onSuccess:E,setIsVariationModalOpen:y,setIsBrandModalOpen:O,groupedVariations:v=[],brands:k=[],categories:T=[],isNew:B=!0})=>{var X,J,a,L;const[u,V]=n.useState("no"),[c,C]=n.useState([]),[o,P]=n.useState(0),[b,K]=n.useState(!1),[h,I]=n.useState({name:"",description:"",brand_id:0,category_id:0,primary_image:[]}),[g,F]=n.useState({quantity:0,web_price:0,web_discount:0,images:[]}),[p,w]=n.useState({selectedVariations:[],quantity:0,web_price:0,web_discount:0,images:[]}),[U,R]=n.useState(null),[N,q]=n.useState(null),[$,z]=n.useState(null);n.useEffect(()=>{var s,t;r&&D&&(V("no"),K(!1),I({name:r.name||"",description:r.description||"",brand_id:((s=r.brand)==null?void 0:s.id)||0,category_id:((t=r.category)==null?void 0:t.id)||0,primary_image:[]}),F({quantity:0,web_price:r.web_price||0,web_discount:0,images:[]}),C([]),w({selectedVariations:[],quantity:0,web_price:r.web_price||0,web_discount:0,images:[]}),R(null),q(null),z(null))},[r,D]);const Q=async()=>{var d,S,Z;if(!r)return;const s=localStorage.getItem("user"),t=(s?(d=JSON.parse(s))==null?void 0:d.id:null)||1;try{let M;if(B){const l=new FormData;if(l.append("name",h.name),l.append("description",h.description),l.append("category_id",h.category_id.toString()),l.append("brand_id",h.brand_id.toString()),l.append("user_id",t.toString()),h.primary_image.length>0)l.append("primary_image",h.primary_image[0]);else{i.error("Please upload a primary product image");return}i.loading("Creating product...");const j=await re.post("/products",l,{headers:{"Content-Type":"multipart/form-data"}});if(j.data.status!=="success"){i.dismiss(),i.error("Failed to create product");return}M=j.data.data.id}else M=r.id;if(i.dismiss(),i.loading("Adding stock..."),u==="no"){if(g.quantity<=0){i.dismiss(),i.error("Please enter a valid quantity");return}const l=new FormData;l.append("product_id",M.toString()),l.append("quantity",g.quantity.toString()),l.append("web_price",g.web_price.toString()),l.append("pos_price","0"),l.append("web_discount",g.web_discount.toString()),l.append("pos_discount","0"),l.append("variations[]","1"),l.append("user_id",t.toString()),g.images.length>0&&l.append("variation_images[]",g.images[0]),await re.post("/stocks",l,{headers:{"Content-Type":"multipart/form-data"}}),i.dismiss(),i.success("Product and stock added successfully"),E(),_()}else{if(c.length===0){i.dismiss(),i.error("Please add at least one variation stock");return}for(const l of c){const j=new FormData;j.append("product_id",M.toString()),j.append("quantity",l.quantity.toString()),j.append("web_price",l.web_price.toString()),j.append("pos_price","0"),j.append("web_discount",l.web_discount.toString()),j.append("pos_discount","0"),j.append("user_id",t.toString()),l.selectedVariations.forEach(pe=>{j.append("variations[]",pe.toString())}),l.images.length>0&&j.append("variation_images[]",l.images[0]),await re.post("/stocks",j,{headers:{"Content-Type":"multipart/form-data"}})}i.dismiss(),i.success(`Product created with ${c.length} stock variant(s)`),E(),_()}}catch(M){i.dismiss(),console.error("Error adding product/stock:",M),i.error(((Z=(S=M.response)==null?void 0:S.data)==null?void 0:Z.message)||"Failed to add product/stock")}},G=()=>{if(p.selectedVariations.length===0){i.error("Please select at least one variation option");return}if(p.quantity<=0){i.error("Please enter a valid quantity");return}if(c.some(d=>d.selectedVariations.length===p.selectedVariations.length&&d.selectedVariations.every(S=>p.selectedVariations.includes(S)))){i.error("This variation combination already exists");return}const t={id:Date.now().toString(),...p};C([...c,t]),w({selectedVariations:[],quantity:0,web_price:(r==null?void 0:r.web_price)||0,web_discount:0,images:[]}),z(null),P(d=>d+1),i.success("Variation stock added to list")},se=s=>{C(c.filter(t=>t.id!==s)),i.info("Variation stock removed")},ae=s=>{w(t=>t.selectedVariations.includes(s)?{...t,selectedVariations:t.selectedVariations.filter(S=>S!==s)}:{...t,selectedVariations:[...t.selectedVariations,s]})},te=s=>{const t=[];return v.forEach(d=>{d.options.forEach(S=>{s.includes(S.id)&&t.push(S.name)})}),t.join(" + ")};return e.jsx(le,{open:D,onOpenChange:_,children:e.jsxs(oe,{className:"sm:max-w-[1000px] max-h-[95vh] flex flex-col p-0 gap-0 rounded-2xl bg-white",children:[e.jsx(ce,{className:"p-6 pb-4 border-b bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 shrink-0",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs(de,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Y,{className:"h-6 w-6 text-green-600"}),"Add Stock to Inventory"]}),e.jsxs(he,{className:"text-gray-600 mt-1",children:["Configure product details and inventory for ",e.jsx("span",{className:"font-semibold text-gray-900",children:r==null?void 0:r.name})]})]})})}),e.jsxs("div",{className:"p-6 space-y-6 bg-white overflow-y-auto flex-1",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/50 backdrop-blur-sm border-b border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-blue-600"}),"Product Details"]}),B&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>K(!b),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 h-8",children:[e.jsx(Re,{className:"h-3.5 w-3.5 mr-1.5"}),b?"View Mode":"Edit Product"]})]}),e.jsx("div",{className:"p-5 space-y-4",children:b?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Product Name"}),e.jsx(f,{placeholder:"Enter product name",className:"h-11 bg-white border-blue-200 focus:border-blue-500 focus:ring-blue-500",value:h.name,onChange:s=>I({...h,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Brand"}),e.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(!0),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100 h-7 text-xs font-semibold -mt-1",children:[e.jsx(H,{className:"h-3.5 w-3.5 mr-1"}),"Add Brand"]})]}),e.jsx("div",{className:"[&_button]:h-11 [&_button]:bg-white [&_button]:border-blue-200 [&_button]:hover:bg-blue-50",children:e.jsx(FormGenerator,{name:"brand_id",label:"",type:"selector",value:((a=h.brand_id)==null?void 0:a.toString())||"",onChange:s=>I({...h,brand_id:parseInt(s.target.value)}),selectOptions:k})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Category"}),e.jsx("div",{className:"[&_button]:h-11 [&_button]:bg-white [&_button]:border-blue-200 [&_button]:hover:bg-blue-50",children:e.jsx(FormGenerator,{name:"category_id",label:"",type:"selector",value:((L=h.category_id)==null?void 0:L.toString())||"",onChange:s=>I({...h,category_id:parseInt(s.target.value)}),selectOptions:T})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Description (Optional)"}),e.jsx(_e,{placeholder:"Enter product description...",className:"min-h-[80px] bg-white border-blue-200 focus:border-blue-500 focus:ring-blue-500",value:h.description,onChange:s=>I({...h,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-blue-600"}),"Primary Product Image (Optional)"]}),e.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 p-3 space-y-3",children:[e.jsx(f,{type:"file",accept:"image/*",onChange:s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&(I({...h,primary_image:[t]}),R(URL.createObjectURL(t)))},className:"cursor-pointer file:cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),U&&e.jsxs("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden border border-gray-200",children:[e.jsx("img",{src:U,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6 bg-white/80 hover:bg-white rounded-full",onClick:()=>{I({...h,primary_image:[]}),R(null)},children:e.jsx(ee,{className:"h-4 w-4 text-gray-500"})})]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Product Name"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:r==null?void 0:r.name})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Brand"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:((X=r==null?void 0:r.brand)==null?void 0:X.name)||"No Brand"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Category"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:((J=r==null?void 0:r.category)==null?void 0:J.name)||"Uncategorized"})]}),(r==null?void 0:r.description)&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100 shadow-sm md:col-span-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:r.description})]})]})})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent"}),e.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx(x,{className:"text-sm font-semibold text-gray-900",children:"Does this product have variations?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(m,{type:"button",variant:u==="no"?"default":"outline",className:`flex-1 h-11 ${u==="no"?"bg-green-600 hover:bg-green-700":"hover:bg-gray-50"}`,onClick:()=>{V("no"),C([])},children:[u==="no"&&e.jsx(A,{className:"h-4 w-4 mr-2"}),"No variations"]}),e.jsxs(m,{type:"button",variant:u==="yes"?"default":"outline",className:`flex-1 h-11 ${u==="yes"?"bg-green-600 hover:bg-green-700":"hover:bg-gray-50"}`,onClick:()=>{V("yes"),C([])},children:[u==="yes"&&e.jsx(A,{className:"h-4 w-4 mr-2"}),"Has variations"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-start gap-1.5",children:[e.jsx(Ce,{className:"h-3.5 w-3.5 mt-0.5 shrink-0"}),'Select "Has variations" if your product comes in different colors, sizes, or other options']})]}),u==="no"?e.jsxs("div",{className:"space-y-5 bg-gradient-to-br from-gray-50 to-slate-50 p-5 rounded-xl border border-gray-200",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-green-600"}),"Stock Configuration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{type:"number",min:"0",placeholder:"100",className:"h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:g.quantity||"",onChange:s=>F({...g,quantity:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold",children:"LKR"}),e.jsx(f,{type:"number",min:"0",step:"0.01",placeholder:"99.99",className:"pl-8 h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:g.web_price||"",onChange:s=>F({...g,web_price:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Discount"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{type:"number",min:"0",max:"100",placeholder:"10",className:"pr-8 h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:g.web_discount||"",onChange:s=>F({...g,web_discount:parseFloat(s.target.value)||0})}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium"})]})]})]}),g.web_discount>0&&g.web_price>0&&e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-300 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-green-700 uppercase tracking-wider",children:"Final Price After Discount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-1",children:["$",(g.web_price*(1-g.web_discount/100)).toFixed(2)]})]}),e.jsxs("div",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:[g.web_discount," OFF"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-600"}),"Product Image (Optional)"]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-300 p-3 space-y-3",children:[e.jsx(f,{type:"file",accept:"image/*",onChange:s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&(F({...g,images:[t]}),q(URL.createObjectURL(t)))},className:"cursor-pointer file:cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"}),N&&e.jsxs("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden border border-gray-200",children:[e.jsx("img",{src:N,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6 bg-white/80 hover:bg-white rounded-full",onClick:()=>{F({...g,images:[]}),q(null)},children:e.jsx(ee,{className:"h-4 w-4 text-gray-500"})})]})]})]})]}):e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-4 bg-white p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),"Select Variation Options"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>y(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50 h-7 text-xs",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Create New"]})]}),v.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:v.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wider",children:s.variation_name}),e.jsx("div",{className:"space-y-1.5 max-h-[120px] overflow-y-auto",children:s.options.map(t=>e.jsxs("label",{className:`flex items-center space-x-2 p-2 rounded-md transition-all cursor-pointer ${p.selectedVariations.includes(t.id)?"bg-green-100 border border-green-300":"bg-white hover:bg-gray-100 border border-transparent"}`,children:[e.jsx(Se,{id:`var-${t.id}`,checked:p.selectedVariations.includes(t.id),onCheckedChange:()=>ae(t.id),className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:t.name})]},t.id))})]},s.variation_id))}):e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:[e.jsx(ne,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"No variation options available"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"text-green-600 border-green-600 hover:bg-green-50",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Create variation"]})]})]}),e.jsxs("div",{className:"space-y-4 bg-gradient-to-br from-gray-50 to-slate-50 p-5 rounded-xl border border-gray-200",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-green-600"}),"Stock Configuration for Selected Variations"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{type:"number",min:"0",placeholder:"50",className:"h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:p.quantity||"",onChange:s=>w({...p,quantity:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-1",children:["Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-semibold",children:"LKR"}),e.jsx(f,{type:"number",min:"0",step:"0.01",placeholder:"99.99",className:"pl-8 h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:p.web_price||"",onChange:s=>w({...p,web_price:parseFloat(s.target.value)||0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs font-semibold text-gray-700",children:"Discount (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{type:"number",min:"0",max:"100",placeholder:"10",className:"pr-8 h-11 bg-white border-gray-300 focus:border-green-500 focus:ring-green-500 font-medium",value:p.web_discount||"",onChange:s=>w({...p,web_discount:parseFloat(s.target.value)||0})}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-xs font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-600"}),"Variation Image (Optional)"]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-300 p-3 space-y-3",children:[e.jsx(f,{type:"file",accept:"image/*",onChange:s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&(w({...p,images:[t]}),z(URL.createObjectURL(t)))},className:"cursor-pointer file:cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"},o),$&&e.jsxs("div",{className:"relative w-32 h-32 rounded-lg overflow-hidden border border-gray-200",children:[e.jsx("img",{src:$,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1 right-1 h-6 w-6 bg-white/80 hover:bg-white rounded-full",onClick:()=>{w({...p,images:[]}),z(null)},children:e.jsx(ee,{className:"h-4 w-4 text-gray-500"})})]})]})]}),e.jsxs(m,{onClick:G,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white h-12 text-base font-semibold shadow-lg shadow-green-200",disabled:p.selectedVariations.length===0,children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"Add This Variation to List"]})]}),c.length>0&&e.jsxs("div",{className:"space-y-4 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 p-5 rounded-xl border-2 border-green-300 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-green-600"}),"Added Variations (",c.length,")"]}),e.jsxs("div",{className:"bg-green-600 text-white px-3 py-1 rounded-full text-xs font-bold",children:[c.length," Stock",c.length!==1?"s":""," Ready"]})]}),e.jsx("div",{className:"space-y-3 max-h-[350px] overflow-y-auto pr-2",children:c.map(s=>e.jsx("div",{className:"bg-white rounded-xl p-4 border-2 border-green-200 shadow-md hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[s.images.length>0&&e.jsx("div",{className:"shrink-0",children:e.jsx("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden border-2 border-gray-200 shadow-sm",children:e.jsx("img",{src:URL.createObjectURL(s.images[0]),alt:"Variation",className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-base text-gray-900 truncate mb-2",children:te(s.selectedVariations)}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold border border-blue-200",children:["Qty: ",s.quantity]}),e.jsxs("span",{className:"bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 px-3 py-1 rounded-full text-xs font-semibold border border-green-200",children:["$",s.web_price]}),s.web_discount>0&&e.jsxs("span",{className:"bg-gradient-to-r from-orange-100 to-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-semibold border border-red-200",children:[s.web_discount," OFF"]}),s.images.length>0&&e.jsxs("span",{className:"bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 px-3 py-1 rounded-full text-xs font-semibold border border-purple-200 flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),"1 Image"]})]})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>se(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-9 w-9 p-0 shrink-0 rounded-lg border border-red-200",children:e.jsx(ke,{className:"h-4 w-4"})})]})},s.id))})]})]})]}),e.jsxs(me,{className:"p-6 pt-4 border-t bg-gradient-to-r from-gray-50 via-slate-50 to-gray-50 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:u==="yes"&&c.length>0&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:[e.jsx("strong",{children:c.length})," variation stock",c.length!==1?"s":""," ready to submit"]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",onClick:_,className:"h-11 px-8 font-semibold border-2",children:"Cancel"}),e.jsxs(m,{onClick:Q,className:"bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 hover:from-green-700 hover:via-emerald-700 hover:to-teal-700 text-white h-11 px-10 shadow-lg shadow-green-300 font-bold text-base",disabled:u==="yes"&&c.length===0,children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),u==="yes"?`Submit ${c.length} Stock${c.length!==1?"s":""}`:"Add Stock to Inventory"]})]})]})]})})},$e=({isOpen:D,onClose:_,variations:r,onSuccess:E})=>{const[y,O]=n.useState({variation_id:"",name:""}),[v,k]=n.useState(!1),[T,B]=n.useState(!1),[u,V]=n.useState(""),c=async()=>{var o,P;if(!u.trim()){i.error("Please enter variation type name");return}k(!0);try{const b=await xe.post("/api/variations",{name:u});b.data.status==="success"?(i.success("Variation type created successfully"),E(),V(""),B(!1)):i.error(b.data.message||"Failed to create variation type")}catch(b){console.error("Error creating variation type:",b),i.error(((P=(o=b.response)==null?void 0:o.data)==null?void 0:P.message)||"Failed to create variation type")}finally{k(!1)}},C=async()=>{var o,P;if(!y.variation_id||!y.name){i.error("Please fill in all fields");return}k(!0);try{const b=await xe.post("/api/variation-options",{variation_id:parseInt(y.variation_id),name:y.name});b.data.status==="success"?(i.success("Variation option created successfully"),E(),_(),O({variation_id:"",name:""})):i.error(b.data.message||"Failed to create variation")}catch(b){console.error("Error creating variation:",b),i.error(((P=(o=b.response)==null?void 0:o.data)==null?void 0:P.message)||"Failed to create variation")}finally{k(!1)}};return e.jsx(le,{open:D,onOpenChange:_,children:e.jsxs(oe,{className:"sm:max-w-[450px] max-h-[90vh] flex flex-col p-0 gap-0 rounded-2xl bg-white",children:[e.jsx(ce,{className:"p-6 pb-4 border-b bg-gray-50/50 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(ne,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx(de,{className:"text-xl",children:"New Variation Option"}),e.jsx(he,{className:"text-gray-500 mt-1",children:"Add a new option to an existing variation type."})]})]})}),e.jsxs("div",{className:"p-6 space-y-6 bg-white overflow-y-auto flex-1",children:[e.jsxs("div",{className:"space-y-4",children:[T?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"New Variation Type"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>{B(!1),V("")},className:"h-7 px-2 text-xs",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),e.jsx(f,{placeholder:"e.g. Color, Size, Material",className:"h-11 bg-white border-gray-200 focus:border-green-500 transition-all",value:u,onChange:o=>V(o.target.value),onKeyDown:o=>o.key==="Enter"&&c()}),e.jsx(m,{onClick:c,disabled:v,className:"w-full bg-green-600 hover:bg-green-700 h-10",children:v?"Creating...":"Create Variation Type"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variation Type"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>B(!0),className:"h-7 px-2 text-xs text-green-600 hover:text-green-700 hover:bg-green-50",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"New Type"]})]}),e.jsxs(Ve,{value:y.variation_id,onValueChange:o=>O({...y,variation_id:o}),children:[e.jsx(Pe,{className:"h-11 bg-white border-gray-200 focus:border-green-500 transition-all",children:e.jsx(Ie,{placeholder:"Select type (e.g. Color, Size)"})}),e.jsx(Fe,{className:"bg-white",children:r.map(o=>e.jsx(Le,{value:o.id.toString(),children:o.name},o.id))})]})]}),!T&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Option Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(f,{placeholder:"e.g. Red, XL, Cotton",className:"pl-9 h-11 bg-white border-gray-200 focus:border-green-500 transition-all",value:y.name,onChange:o=>O({...y,name:o.target.value}),onKeyDown:o=>o.key==="Enter"&&C()})]})]})]}),e.jsxs("div",{className:"bg-blue-50/50 border border-blue-100 rounded-lg p-3 text-sm text-blue-700 flex gap-2",children:[e.jsx("div",{className:"shrink-0 mt-0.5",children:e.jsx("div",{className:"h-4 w-4 rounded-full bg-blue-200 flex items-center justify-center text-[10px] font-bold text-blue-700",children:"i"})}),e.jsx("p",{children:"Creating a new option will make it available for all products using this variation type."})]})]}),e.jsxs(me,{className:"p-6 pt-4 border-t bg-gray-50/50",children:[e.jsx(m,{variant:"outline",onClick:_,className:"h-11 px-6",children:"Close"}),!T&&e.jsx(m,{onClick:C,disabled:v,className:"bg-green-600 hover:bg-green-700 h-11 px-6 shadow-sm shadow-green-200",children:v?"Creating...":"Create Option"})]})]})})},ps=()=>{const[D,_]=n.useState([]),[r,E]=n.useState(!0),[y,O]=n.useState(!1),[v,k]=n.useState(!1),[T,B]=n.useState(""),[u,V]=n.useState(null),[c,C]=n.useState([]),[o,P]=n.useState([]),[b,K]=n.useState([]),[h,I]=n.useState([]),[g,F]=n.useState(!1),[p,w]=n.useState(!1),[U,R]=n.useState(!1),[N,q]=n.useState({name:"",slug:"",image:null});n.useEffect(()=>{$(),z(),Q(),G(),se()},[]);const $=async()=>{O(!0),E(!0);try{const a=await fe(T);a.status==="success"&&_(a.data)}catch(a){console.error("Error fetching products:",a),i.error("Failed to load products")}finally{E(!1),O(!1)}},z=async()=>{try{const a=await ye(!0);a.status==="success"&&C(a.data)}catch(a){console.error("Error fetching variations:",a)}},Q=async()=>{try{const a=await je();a.status==="success"&&P(a.data)}catch(a){console.error("Error fetching parent variations:",a)}},G=async()=>{try{const a=await ve();a.status==="success"&&K(a.data)}catch(a){console.error("Error fetching brands:",a)}},se=async()=>{try{const a=await Ne();a.status==="success"&&I(a.data)}catch(a){console.error("Error fetching categories:",a)}},ae=a=>{if(!a.stocks||a.stocks.length===0)return"LKR 0.00";const L=a.stocks.map(d=>{const S=parseFloat(d.web_price),Z=parseFloat(d.web_discount);return S-Z}),s=Math.min(...L),t=Math.max(...L);return s===t?`LKR ${s.toFixed(2)}`:`LKR ${s.toFixed(2)} - LKR ${t.toFixed(2)}`},te=a=>{a.preventDefault(),$()},X=a=>{V(a),F(!0)},J=async()=>{k(!0);try{const a=new FormData;a.append("name",N.name),a.append("slug",N.slug),N.image&&a.append("image",N.image),(await we(a)).status==="success"&&(i.success("Brand created successfully"),G(),R(!1),q({name:"",slug:"",image:null}))}catch{i.error("Failed to create brand")}finally{k(!1)}};return e.jsxs(be,{children:[e.jsx(ue,{title:"Add Existing Product"}),e.jsxs("div",{className:"space-y-8 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Product Catalog"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Browse the global catalog and add products to your inventory."})]})}),e.jsxs("form",{onSubmit:te,className:"relative max-w-2xl",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})}),e.jsx(f,{placeholder:"Search by product name, brand, or category...",className:"pl-11 h-12 text-lg bg-white shadow-sm border-gray-200 focus:border-green-500 focus:ring-green-500 rounded-xl",value:T,onChange:a=>B(a.target.value)}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsxs(m,{type:"submit",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white rounded-lg px-4",disabled:y,children:[y&&e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Search"]})})]}),r?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(ie,{className:"h-10 w-10 animate-spin text-green-600 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading products..."})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:D.map(a=>{var L,s;return e.jsxs("div",{className:"group bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"aspect-[4/3] bg-gray-50 relative overflow-hidden",children:[e.jsx("img",{src:`/${a.primary_image}`,alt:a.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:t=>{t.target.src="https://placehold.co/400?text=No+Image"}}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white/90 text-gray-700 backdrop-blur-sm shadow-sm",children:((L=a.category)==null?void 0:L.name)||"Uncategorized"})})]}),e.jsxs("div",{className:"p-5 flex-1 flex flex-col",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-bold text-gray-900 line-clamp-1 text-lg group-hover:text-green-600 transition-colors",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 font-medium",children:(s=a.brand)==null?void 0:s.name})]}),e.jsxs("div",{className:"mt-auto pt-4 border-t border-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Price Range:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-900",children:ae(a)})]}),e.jsxs(m,{size:"sm",className:"bg-gray-900 text-white hover:bg-green-600 transition-colors rounded-lg",onClick:()=>X(a),children:["Select",e.jsx(Ee,{className:"ml-1.5 h-3.5 w-3.5"})]})]})]})]},a.id)})}),!r&&D.length===0&&e.jsxs("div",{className:"text-center py-20 bg-gray-50 rounded-2xl border border-dashed border-gray-200",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No products found"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Try adjusting your search terms or check back later."})]})]}),e.jsx(Me,{isOpen:g,onClose:()=>F(!1),product:u,onSuccess:()=>{z()},setIsVariationModalOpen:w,setIsBrandModalOpen:R,groupedVariations:c,brands:b,categories:h,isNew:!1}),e.jsx($e,{isOpen:p,onClose:()=>w(!1),variations:o,onSuccess:()=>{z(),Q()}}),e.jsx(le,{open:U,onOpenChange:R,children:e.jsxs(oe,{className:"bg-white",children:[e.jsx(ce,{children:e.jsx(de,{children:"Create Brand"})}),e.jsxs("div",{className:"space-y-4 py-4 bg-white",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Brand Name"}),e.jsx(f,{placeholder:"Brand Name",value:N.name,onChange:a=>q({...N,name:a.target.value,slug:a.target.value.toLowerCase().replace(/\s+/g,"-")})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Slug"}),e.jsx(f,{placeholder:"brand-slug",value:N.slug,onChange:a=>q({...N,slug:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Logo"}),e.jsx(f,{type:"file",onChange:a=>a.target.files&&q({...N,image:a.target.files[0]})})]})]}),e.jsxs(me,{children:[e.jsx(m,{variant:"outline",onClick:()=>R(!1),disabled:v,children:"Cancel"}),e.jsxs(m,{onClick:J,disabled:v,children:[v&&e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Create"]})]})]})})]})};export{ps as default};
