import{r as i,t as l,j as e,S as k}from"./app-BevSkdG7.js";import{a as R,b as L,d as $,g as A,N as P,F,p as J}from"./Footer-CorOyyjV.js";import{S as M}from"./StepperNav-BidMZozQ.js";import{h as T,i as B,j as D,k as H,l as Y,m as I,F as Q}from"./index-Dc9H6sBh.js";import"./logo-D38OwFmG.js";import"./auth-BlSIcDT4.js";const U=({onSubmit:w,loading:b})=>{const[a,g]=i.useState({name:"",email:"",mobile:"",region_id:"",prefecture_id:"",postal_code:"",city:"",address_line_1:"",address_line_2:"",payment_method:"card"}),[x,C]=i.useState([]),[_,N]=i.useState([]),[v,j]=i.useState([]),[r,u]=i.useState(!1),[p,d]=i.useState(!1),[c,m]=i.useState(!1);i.useEffect(()=>{y();const s=localStorage.getItem("user");if(s){const t=JSON.parse(s);g(n=>({...n,name:t.name||"",email:t.email||"",mobile:t.mobile||""}))}},[]);const y=async()=>{u(!0);try{const s=await R();C(s)}catch(s){console.error("Error loading regions:",s),l.error("Failed to load regions")}finally{u(!1)}},o=async s=>{if(g(t=>({...t,region_id:s,prefecture_id:"",postal_code:"",city:""})),N([]),j([]),!!s){d(!0);try{const t=await L(s);N(t)}catch(t){console.error("Error loading prefectures:",t),l.error("Failed to load prefectures")}finally{d(!1)}}},h=async s=>{const t=_.find(n=>n.id.toString()===s);if(g(n=>({...n,prefecture_id:s,postal_code:"",city:""})),j([]),!!t){m(!0);try{const n=await $(t.prefecture_name);j(n)}catch(n){console.error("Error loading postal codes:",n),l.error("Failed to load postal codes")}finally{m(!1)}}},S=s=>{const t=v.find(n=>n.postal_code===s);g(n=>({...n,postal_code:s,city:(t==null?void 0:t.city_name_en)||""}))},f=s=>{const{name:t,value:n}=s.target;g(O=>({...O,[t]:n}))},q=()=>a.name.trim()?!a.email.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)?(l.error("Please enter a valid email address"),!1):a.mobile.trim()?a.region_id?a.prefecture_id?a.postal_code?a.city.trim()?a.address_line_1.trim()?a.address_line_2.trim()?!0:(l.error("Please enter additional address details"),!1):(l.error("Please enter your address"),!1):(l.error("City is required"),!1):(l.error("Please select a postal code"),!1):(l.error("Please select a prefecture"),!1):(l.error("Please select a region"),!1):(l.error("Please enter your mobile number"),!1):(l.error("Please enter your name"),!1),E=s=>{s.preventDefault(),q()&&w(a)};return e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(T,{className:"inline w-4 h-4 mr-1"}),"Full Name *"]}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(B,{className:"inline w-4 h-4 mr-1"}),"Email Address *"]}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"john@example.com",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(D,{className:"inline w-4 h-4 mr-1"}),"Mobile Number *"]}),e.jsx("input",{type:"tel",name:"mobile",value:a.mobile,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"+81 90-1234-5678",required:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:[e.jsx(H,{className:"inline w-5 h-5 mr-2"}),"Shipping Address"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Region *"}),e.jsxs("select",{name:"region_id",value:a.region_id,onChange:s=>o(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:r,required:!0,children:[e.jsx("option",{value:"",children:"Select Region"}),x.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prefecture *"}),e.jsxs("select",{name:"prefecture_id",value:a.prefecture_id,onChange:s=>h(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:!a.region_id||p,required:!0,children:[e.jsx("option",{value:"",children:"Select Prefecture"}),_.map(s=>e.jsx("option",{value:s.id,children:s.prefecture_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Postal Code *"}),e.jsxs("select",{name:"postal_code",value:a.postal_code,onChange:s=>S(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:!a.prefecture_id||c,required:!0,children:[e.jsx("option",{value:"",children:"Select Postal Code"}),v.map(s=>e.jsx("option",{value:s.postal_code,children:s.postal_code},s.postal_code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsx("input",{type:"text",name:"city",value:a.city,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-gray-50",placeholder:"City",readOnly:!0,required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address Line 1 *"}),e.jsx("input",{type:"text",name:"address_line_1",value:a.address_line_1,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Street address, P.O. box",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address Line 2 *"}),e.jsx("input",{type:"text",name:"address_line_2",value:a.address_line_2,onChange:f,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Apartment, suite, unit, building, floor, etc.",required:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:[e.jsx(Y,{className:"inline w-5 h-5 mr-2"}),"Payment Method"]}),e.jsx("div",{className:"space-y-3",children:[{value:"card",label:"Credit/Debit Card",description:"Pay securely with Stripe"},{value:"cash_on_delivery",label:"Cash on Delivery",description:"Pay when you receive"},{value:"bank_transfer",label:"Bank Transfer",description:"Transfer to our account"},{value:"home_delivery_2",label:"Home Delivery Payment",description:"Available for select areas"}].map(s=>e.jsxs("label",{className:`flex items-start p-4 border-2 rounded-lg cursor-pointer transition-all ${a.payment_method===s.value?"border-green-600 bg-green-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"payment_method",value:s.value,checked:a.payment_method===s.value,onChange:f,className:"mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.label}),e.jsx("div",{className:"text-sm text-gray-500",children:s.description})]})]},s.value))})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-4 rounded-full transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Processing...":"Continue to Payment"})]})},Z=()=>{const[w,b]=i.useState(!1),[a,g]=i.useState([]),[x,C]=i.useState({total_amount:0,total_discount:0,total_tax:0,grand_total:0}),[_,N]=i.useState(!1);i.useEffect(()=>{const r=localStorage.getItem("token");if(N(!!r),!r){l.error("Please login to continue checkout"),setTimeout(()=>k.visit("/login"),1500);return}v()},[]);const v=async()=>{try{const r=await A();if(!r.cart_items||r.cart_items.length===0){l.error("Your cart is empty"),setTimeout(()=>k.visit("/products"),1500);return}g(r.cart_items),C({total_amount:r.total_amount||0,total_discount:r.total_discount||0,total_tax:r.total_tax||0,grand_total:r.grand_total||0})}catch(r){console.error("Error loading cart:",r),l.error("Failed to load cart")}},j=async r=>{var u,p;b(!0);try{const d=localStorage.getItem("token"),c=localStorage.getItem("user"),m=c?JSON.parse(c):null,y={userData:{city:r.city,prefecture_id:r.prefecture_id,region_id:r.region_id,postal_code:r.postal_code,address_line_1:r.address_line_1,address_line_2:r.address_line_2,name:r.name,email:r.email,mobile:r.mobile,device_name:"web",user_id:(m==null?void 0:m.id)||null},paymentData:{payment_gateway:r.payment_method==="card"?"stripe":"other",due_date:null,method:r.payment_method},cart_items:a.map(h=>({stock_id:h.stock_id,quantity:h.quantity}))},o=await J(y);o.status==="success"&&(localStorage.setItem("payment",JSON.stringify(o.data.payment)),localStorage.setItem("payment_intent",o.data.payment.paymentIntent),localStorage.setItem("paymentMethod",r.payment_method),localStorage.setItem("user",JSON.stringify(o.data.user)),localStorage.setItem("address",JSON.stringify(o.data.address)),localStorage.setItem("orderId",o.data.payment.order_id.toString()),o.data.user.token&&localStorage.setItem("token",o.data.user.token),l.success("Order placed successfully!"),k.visit("/checkout/step2"))}catch(d){console.error("Error placing order:",d);const c=((p=(u=d.response)==null?void 0:u.data)==null?void 0:p.message)||"Failed to place order";l.error(c)}finally{b(!1)}};return _?e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsx(P,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("nav",{className:"flex text-sm text-gray-500 mb-6",children:[e.jsx("a",{href:"/",className:"hover:text-green-600",children:"Home"}),e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("a",{href:"/cart",className:"hover:text-green-600",children:"Cart"}),e.jsx("span",{className:"mx-2",children:"/"}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Checkout"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center justify-center",children:[e.jsx(I,{className:"mr-3 text-green-600"}),"Secure Checkout"]}),e.jsx("p",{className:"text-gray-600",children:"Complete your purchase safely and securely"})]}),e.jsx(M,{currentStep:1}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(U,{onSubmit:j,loading:w})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-24",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center",children:[e.jsx(Q,{className:"mr-2"}),"Order Summary"]}),e.jsx("div",{className:"space-y-4 mb-6",children:a.map(r=>{var u,p,d,c,m,y,o,h,S;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:((p=(u=r.stock)==null?void 0:u.product)==null?void 0:p.primary_image)||"/placeholder.png",alt:(c=(d=r.stock)==null?void 0:d.product)==null?void 0:c.name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:(y=(m=r.stock)==null?void 0:m.product)==null?void 0:y.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",r.quantity]})]}),e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["$",(((((o=r.stock)==null?void 0:o.web_price)||0)-(((h=r.stock)==null?void 0:h.web_price)||0)*(((S=r.stock)==null?void 0:S.web_discount)||0)/100)*r.quantity).toFixed(2)]})]},r.id)})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-semibold",children:["$",(x.total_amount||0).toFixed(2)]})]}),(x.total_discount||0)>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"font-semibold",children:["-$",(x.total_discount||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Tax (8%)"}),e.jsxs("span",{className:"font-semibold",children:["$",(x.total_tax||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{className:"font-semibold",children:"Calculated at next step"})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Total"}),e.jsxs("span",{className:"font-bold text-green-600",children:["$",(x.grand_total||0).toFixed(2)]})]})})]}),e.jsx("div",{className:"mt-6 p-4 bg-green-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-800 flex items-center",children:[e.jsx(I,{className:"mr-2"}),"Your payment information is secure and encrypted"]})})]})})]})]}),e.jsx(F,{})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsx(P,{}),e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}),e.jsx(F,{})]})};export{Z as default};
